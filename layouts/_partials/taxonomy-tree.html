{{ $show := default true (default .Site.Params.ShowTaxonomyTree .Params.ShowTaxonomyTree) }}
{{ if $show }}
  <hr>
  <menu>
    {{ $taxonomyTitles := .Site.Params.taxonomyTitles}}
    {{- range $taxonomyName, $taxonomy := .Site.Taxonomies }} 
      {{- $taxonomyTitle := index $taxonomyTitles $taxonomyName | default $taxonomyName }} 
      {{- with $taxonomy }}
        <li>
          <details>
            <summary>
              <a href="/{{ $taxonomyName }}">{{ $taxonomyTitle }} </a> <sup>{{ len $taxonomy }}</sup>
            </summary>
            {{- range $name, $value := $taxonomy }}
              {{- $count := $value.Count }}
              {{- $page := site.GetPage (printf "/%s/%s" $taxonomyName $name) }}
              <menu>
                {{- with $page }}
                  <li><a href="{{ .Permalink }}">{{ .Name }}</a> <sup>{{ $count }}</sup></li>
                {{- end }}
              </menu>
            {{- end }}
          </details>
        </li>
      {{- end }} 
    {{- end }}
  </menu>
{{- end}}
