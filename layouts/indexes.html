{{- define "main" -}}
  <header>
    {{- partial "breadcrumbs" . -}}
  </header>
  <article>
    {{- .Content -}}
    <h2>Sections</h2>
    {{ range .Site.Sections }}
      {{- partial "section-tree-walk.html" (dict "page" .) -}}
    {{ end }}
    <h2>Taxonomies</h2>
    {{- range $taxonomy, $terms := .Site.Taxonomies -}}
      <h3>
        <a class="sectionlink" href="/{{- .Page.RelPermalink -}}"
          >{{ $terms.Page.Title }} </a
        ><sup>{{- len $terms -}}</sup>
      </h3>
      {{- $description := index site.Params.taxonomyDescription $taxonomy -}}
      {{- with $description -}}
        <p>{{- . -}}</p>
      {{- end -}}
      {{- with .Page.Params.Summary -}}
        <p>{{- . -}}</p>
      {{- end -}}
      {{- range . }}
        <a class="tag" href="{{- .Page.RelPermalink -}}"
          >{{- .Page.Title -}}<sup>{{- .Count -}}</sup></a
        >
      {{ end -}}
    {{- end -}}
  </article>
{{- end -}}

{{- define "_partials/section-tree-walk.html" -}}
  {{- $page := .page -}}
  <ul class="section-tree">
    <li>
      <a class="sectionlink" href="{{- $page.RelPermalink -}}"
        >{{- $page.Title -}}</a
      >
      {{- with $page.Params.Summary }}
        {{ . -}}
      {{- end -}}
      {{- if $page.Sections -}}
        {{- range $page.Sections -}}
          {{- partial "section-tree-walk.html" (dict "page" .) -}}
        {{- end -}}
      {{- end -}}
    </li>
  </ul>
{{- end -}}
